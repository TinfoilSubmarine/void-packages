# Template file for 'Gridcoin-Research'
pkgname=Gridcoin-Research
version=5.4.6.0
revision=1
build_style=gnu-configure
configure_args="--with-boost=${XBPS_CROSS_BASE}/usr --libdir=${XBPS_CROSS_BASE}/usr/lib"
hostmakedepends="automake libtool pkg-config"
makedepends="openssl-devel boost-devel libevent-devel miniupnpc-devel
 qt5-tools-devel qrencode-devel libzip-devel qt5-charts-devel libcurl-devel"
short_desc="Open source cryptocurrency rewarding computing through BOINC"
maintainer="Joel Beckmeyer <joel@beckmeyer.us>"
license="MIT"
homepage="https://gridcoin.us"
changelog="https://raw.githubusercontent.com/gridcoin-community/Gridcoin-Research/development/CHANGELOG.md"
distfiles="https://github.com/gridcoin-community/Gridcoin-Research/archive/refs/tags/${version}.tar.gz"
checksum=3d765e4f4b7852349bcf97bdb21b797fc76db7feacd45170771560ab19f8f923

if [ "$CROSS_BUILD" ]; then
	hostmakedepends+=" qt5-host-tools"
fi

pre_configure() {
	./autogen.sh
	# taken from bitcoin package to fix CRC32 errors
	case "$XBPS_TARGET_MACHINE" in
	aarch64*)
		CFLAGS=${CFLAGS/armv8-a/armv8-a+crc+crypto}
		CXXFLAGS=${CXXFLAGS/armv8-a/armv8-a+crc+crypto}
		;;
	esac
}

post_install() {
	rm "${DESTDIR}"/usr/bin/test_gridcoin{,-qt}
	vlicense COPYING
}

Gridcoin-Research-qt_package() {
	short_desc+=" - QT GUI"
	pkg_install() {
		vmove usr/bin/gridcoinresearch
		vmove usr/share/applications
		vmove usr/share/icons
		vmove usr/share/man/man1/gridcoinresearch.1
		vlicense COPYING
	}
}
